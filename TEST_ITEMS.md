# 預り金管理システム テスト項目書

## テスト項目一覧

### 1. 施設選択機能

#### TC-001: 施設選択画面の表示
- **前提条件**: なし
- **手順**: 
  1. `/facility-select` にアクセス
- **期待結果**: 
  - 施設選択画面が表示される
  - アクティブな施設の一覧が表示される
- **優先度**: High

#### TC-002: 施設の選択
- **前提条件**: 施設が登録されている
- **手順**: 
  1. 施設選択画面で施設を選択
  2. 「選択」ボタンをクリック
- **期待結果**: 
  - ダッシュボードに遷移する
  - 選択した施設がコンテキストに保存される
- **優先度**: High

#### TC-003: 施設選択の変更
- **前提条件**: 施設が選択済み
- **手順**: 
  1. ダッシュボードから「施設選択を変更」をクリック
  2. 別の施設を選択
- **期待結果**: 
  - 新しい施設が選択される
  - ダッシュボードが更新される
- **優先度**: Medium

---

### 2. ダッシュボード機能

#### TC-101: ダッシュボードの初期表示
- **前提条件**: 施設が選択済み
- **手順**: 
  1. `/` にアクセス
- **期待結果**: 
  - 法人全体または選択施設の預り金合計が表示される
  - 各施設の合計金額がカード表示される
  - 年月選択が表示される
- **優先度**: High

#### TC-102: 年月の変更
- **前提条件**: ダッシュボードが表示されている
- **手順**: 
  1. 年月セレクターで年月を変更
- **期待結果**: 
  - 選択した年月のデータが表示される
  - 各施設の合計金額が更新される
- **優先度**: High

#### TC-103: 施設カードのクリック
- **前提条件**: ダッシュボードに施設カードが表示されている
- **手順**: 
  1. 施設カードをクリック
- **期待結果**: 
  - 施設詳細画面に遷移する
  - URLに施設IDと年月が含まれる
- **優先度**: High

#### TC-104: 施設選択時のフィルタリング
- **前提条件**: 施設が選択済み
- **手順**: 
  1. ダッシュボードを表示
- **期待結果**: 
  - 選択した施設の情報のみが表示される
  - 選択中の施設名が表示される
- **優先度**: High

---

### 3. 施設詳細画面

#### TC-201: 施設詳細画面の表示
- **前提条件**: 施設IDが存在する
- **手順**: 
  1. `/facilities/[id]` にアクセス
- **期待結果**: 
  - 施設名が表示される
  - 施設合計カードが表示される
  - ユニット別合計カードが表示される
  - 利用者別残高カードが表示される
- **優先度**: High

#### TC-202: ユニットでの絞り込み
- **前提条件**: 施設詳細画面が表示されている
- **手順**: 
  1. ユニットカードをクリック
- **期待結果**: 
  - 選択したユニットの利用者のみが表示される
  - ユニットカードがハイライトされる
  - 「絞り込み解除」ボタンが表示される
- **優先度**: High

#### TC-203: 絞り込みの解除
- **前提条件**: ユニットで絞り込み中
- **手順**: 
  1. 「絞り込み解除」ボタンをクリック
- **期待結果**: 
  - すべての利用者が表示される
  - ユニットカードのハイライトが解除される
- **優先度**: Medium

#### TC-204: 利用者カードのクリック
- **前提条件**: 施設詳細画面に利用者カードが表示されている
- **手順**: 
  1. 利用者カードをクリック
- **期待結果**: 
  - 利用者詳細画面に遷移する
  - URLに利用者IDと年月が含まれる
- **優先度**: High

#### TC-205: 年月の変更
- **前提条件**: 施設詳細画面が表示されている
- **手順**: 
  1. 年月セレクターで年月を変更
- **期待結果**: 
  - 選択した年月のデータが表示される
  - 施設合計、ユニット別合計、利用者別残高が更新される
- **優先度**: High

---

### 4. 利用者詳細画面

#### TC-301: 利用者詳細画面の表示
- **前提条件**: 利用者IDが存在する
- **手順**: 
  1. `/residents/[id]` にアクセス
- **期待結果**: 
  - 利用者名が表示される
  - 現在残高が表示される
  - 明細テーブルが表示される
  - 年月セレクターが表示される
- **優先度**: High

#### TC-302: 前後の利用者への移動
- **前提条件**: 利用者詳細画面が表示されている
- **手順**: 
  1. 「◀」ボタンをクリック（前の利用者へ）
  2. 「▶」ボタンをクリック（次の利用者へ）
- **期待結果**: 
  - 前後の利用者の詳細画面に遷移する
  - 同じ年月が維持される
- **優先度**: Medium

#### TC-303: 明細テーブルの表示
- **前提条件**: 利用者詳細画面が表示されている
- **手順**: 
  1. 明細テーブルを確認
- **期待結果**: 
  - 日付、区分、摘要、支払先、金額、残高が表示される
  - 取引が日付順にソートされている
  - 残高が正しく計算されている
- **優先度**: High

---

### 5. 入金・出金機能

#### TC-401: 入金モーダルの表示（当月）
- **前提条件**: 利用者詳細画面が表示され、当月を表示中
- **手順**: 
  1. 「💰 入金」ボタンをクリック
- **期待結果**: 
  - 入金モーダルが表示される
  - 対象日の入力範囲が設定されている（10日以前: 先月1日〜今月末日、11日以降: 今月1日〜今日）
- **優先度**: High

#### TC-402: 入金の登録（正常系）
- **前提条件**: 入金モーダルが表示されている
- **手順**: 
  1. 対象日を入力
  2. 金額を入力（1円以上の整数）
  3. 内容（備考）を入力（任意）
  4. 支払先を入力（任意）
  5. 「登録」ボタンをクリック
- **期待結果**: 
  - 入金が登録される
  - モーダルが閉じる
  - 残高が更新される
  - 明細に追加される
  - 成功メッセージが表示される
- **優先度**: High

#### TC-403: 出金の登録（正常系）
- **前提条件**: 出金モーダルが表示されている
- **手順**: 
  1. 対象日を入力
  2. 金額を入力（1円以上の整数）
  3. 内容（備考）を入力（任意）
  4. 支払先を入力（任意）
  5. 「登録」ボタンをクリック
- **期待結果**: 
  - 出金が登録される
  - モーダルが閉じる
  - 残高が更新される
  - 明細に追加される
  - 成功メッセージが表示される
- **優先度**: High

#### TC-404: 入金・出金のバリデーション（対象日範囲外）
- **前提条件**: 入金モーダルが表示されている（当月）
- **手順**: 
  1. 許可範囲外の日付を入力
  2. 「登録」ボタンをクリック
- **期待結果**: 
  - エラーメッセージが表示される
  - 登録されない
- **優先度**: High

#### TC-405: 入金・出金のバリデーション（金額が0以下）
- **前提条件**: 入金モーダルが表示されている
- **手順**: 
  1. 金額に0または負の数を入力
  2. 「登録」ボタンをクリック
- **期待結果**: 
  - エラーメッセージが表示される
  - 登録されない
- **優先度**: High

#### TC-406: 入金・出金のバリデーション（金額が小数）
- **前提条件**: 入金モーダルが表示されている
- **手順**: 
  1. 金額に小数を入力（例: 100.5）
  2. 「登録」ボタンをクリック
- **期待結果**: 
  - エラーメッセージが表示される
  - 登録されない
- **優先度**: Medium

#### TC-407: 過去月での入金・出金ボタンの非表示
- **前提条件**: 利用者詳細画面が表示され、過去月を表示中
- **手順**: 
  1. 画面を確認
- **期待結果**: 
  - 「💰 入金」「💸 出金」ボタンが表示されない
  - 「✏️ 訂正入力」ボタンが表示される
- **優先度**: High

---

### 6. 訂正入力機能

#### TC-501: 訂正入力モーダルの表示（過去月）
- **前提条件**: 利用者詳細画面が表示され、過去月を表示中
- **手順**: 
  1. 「✏️ 訂正入力」ボタンをクリック
- **期待結果**: 
  - 訂正入力モーダルが表示される
  - 区分選択（過去訂正入金/過去訂正出金）が表示される
  - 理由入力欄が表示される
- **優先度**: High

#### TC-502: 過去訂正入金の登録（正常系）
- **前提条件**: 訂正入力モーダルが表示されている
- **手順**: 
  1. 対象日を入力（過去月の日付）
  2. 区分を「過去訂正入金」に設定
  3. 金額を入力
  4. 理由を入力
  5. 「登録」ボタンをクリック
- **期待結果**: 
  - 過去訂正入金が登録される
  - 残高が更新される
  - 明細に追加される
  - 成功メッセージが表示される
- **優先度**: High

#### TC-503: 過去訂正出金の登録（正常系）
- **前提条件**: 訂正入力モーダルが表示されている
- **手順**: 
  1. 対象日を入力（過去月の日付）
  2. 区分を「過去訂正出金」に設定
  3. 金額を入力
  4. 理由を入力
  5. 「登録」ボタンをクリック
- **期待結果**: 
  - 過去訂正出金が登録される
  - 残高が更新される
  - 明細に追加される
  - 成功メッセージが表示される
- **優先度**: High

#### TC-504: 訂正入力のバリデーション（理由未入力）
- **前提条件**: 訂正入力モーダルが表示されている
- **手順**: 
  1. 理由を入力せずに「登録」ボタンをクリック
- **期待結果**: 
  - エラーメッセージが表示される
  - 登録されない
- **優先度**: High

#### TC-505: 訂正入力のバリデーション（今月の日付）
- **前提条件**: 訂正入力モーダルが表示されている
- **手順**: 
  1. 今月の日付を入力
  2. 「登録」ボタンをクリック
- **期待結果**: 
  - エラーメッセージが表示される
  - 登録されない
- **優先度**: High

#### TC-506: 取引の訂正マーク
- **前提条件**: 利用者詳細画面が表示され、当月を表示中、取引が存在する
- **手順**: 
  1. 取引の「✏️ 訂正」ボタンをクリック
  2. 確認ダイアログで「OK」をクリック
- **期待結果**: 
  - 取引が訂正としてマークされる
  - 取引が打ち消し線で表示される
  - 残高から除外される
  - 成功メッセージが表示される
- **優先度**: High

---

### 7. 残高計算

#### TC-601: 残高計算の正確性（入金のみ）
- **前提条件**: 利用者が存在し、取引がない
- **手順**: 
  1. 入金を複数回登録
  2. 残高を確認
- **期待結果**: 
  - 残高 = すべての入金額の合計
- **優先度**: Critical

#### TC-602: 残高計算の正確性（出金のみ）
- **前提条件**: 利用者が存在し、取引がない
- **手順**: 
  1. 入金を登録
  2. 出金を複数回登録
  3. 残高を確認
- **期待結果**: 
  - 残高 = 入金額 - 出金額の合計
- **優先度**: Critical

#### TC-603: 残高計算の正確性（訂正取引の除外）
- **前提条件**: 利用者が存在し、取引がある
- **手順**: 
  1. 入金を登録
  2. その取引を訂正としてマーク
  3. 残高を確認
- **期待結果**: 
  - 訂正された取引は残高計算から除外される
  - 残高が正しく更新される
- **優先度**: Critical

#### TC-604: 残高計算の正確性（過去訂正取引の含める）
- **前提条件**: 利用者が存在し、取引がある
- **手順**: 
  1. 過去月に過去訂正入金を登録
  2. 残高を確認
- **期待結果**: 
  - 過去訂正取引は残高計算に含まれる
  - 残高が正しく更新される
- **優先度**: Critical

#### TC-605: 月次残高の計算
- **前提条件**: 複数月の取引が存在する
- **手順**: 
  1. 異なる年月を選択
  2. 各年月の残高を確認
- **期待結果**: 
  - 各年月の残高が正しく計算される
  - 累積残高が正しい
- **優先度**: Critical

---

### 8. マスタ管理

#### TC-701: 施設マスタの表示
- **前提条件**: `/master` にアクセス
- **手順**: 
  1. 施設タブを選択
- **期待結果**: 
  - 施設一覧が表示される
  - 施設名、表示順が表示される
- **優先度**: Medium

#### TC-702: ユニットマスタの表示
- **前提条件**: `/master` にアクセス
- **手順**: 
  1. ユニットタブを選択
- **期待結果**: 
  - ユニット一覧が表示される
  - ユニット名、所属施設が表示される
- **優先度**: Medium

#### TC-703: 利用者マスタの表示
- **前提条件**: `/master` にアクセス
- **手順**: 
  1. 利用者タブを選択
- **期待結果**: 
  - 利用者一覧が表示される
  - 利用者名、所属施設、所属ユニットが表示される
- **優先度**: Medium

---

### 9. データインポート

#### TC-801: CSVデータのインポート
- **前提条件**: `/import` にアクセス
- **手順**: 
  1. CSV形式のデータを貼り付け
  2. 「インポート」ボタンをクリック
- **期待結果**: 
  - データがインポートされる
  - 施設・ユニット・利用者が作成される
  - 初期残高が設定される
- **優先度**: High

#### TC-802: インポートのバリデーション
- **前提条件**: `/import` にアクセス
- **手順**: 
  1. 不正な形式のデータを貼り付け
  2. 「インポート」ボタンをクリック
- **期待結果**: 
  - エラーメッセージが表示される
  - データがインポートされない
- **優先度**: Medium

---

### 10. 一括入力機能

#### TC-901: 一括入力画面の表示
- **前提条件**: 施設詳細画面から「まとめて入力」をクリック
- **手順**: 
  1. `/facilities/[id]/bulk-input` にアクセス
- **期待結果**: 
  - 一括入力画面が表示される
  - 利用者一覧が表示される
- **優先度**: High

#### TC-902: 一括入力の実行
- **前提条件**: 一括入力画面が表示されている
- **手順**: 
  1. 複数の利用者に取引を入力
  2. 「一括登録」ボタンをクリック
- **期待結果**: 
  - すべての取引が登録される
  - 各利用者の残高が更新される
- **優先度**: High

---

### 11. 印刷機能

#### TC-1001: 印刷プレビュー画面の表示
- **前提条件**: 施設詳細画面または利用者詳細画面から「印刷」をクリック
- **手順**: 
  1. `/print/preview` にアクセス
- **期待結果**: 
  - 印刷プレビュー画面が表示される
  - 印刷対象のデータが表示される
- **優先度**: Medium

---

### 12. エラーハンドリング

#### TC-1101: 存在しない施設IDへのアクセス
- **前提条件**: 存在しない施設ID
- **手順**: 
  1. `/facilities/99999` にアクセス
- **期待結果**: 
  - エラーメッセージが表示される
  - または適切なエラーページが表示される
- **優先度**: Medium

#### TC-1102: 存在しない利用者IDへのアクセス
- **前提条件**: 存在しない利用者ID
- **手順**: 
  1. `/residents/99999` にアクセス
- **期待結果**: 
  - エラーメッセージが表示される
  - または適切なエラーページが表示される
- **優先度**: Medium

#### TC-1103: APIエラーの処理
- **前提条件**: APIがエラーを返す
- **手順**: 
  1. 不正なデータでAPIを呼び出す
- **期待結果**: 
  - エラーメッセージが表示される
  - システムがクラッシュしない
- **優先度**: High

---

### 13. UI/UX

#### TC-1201: ローディング状態の表示
- **前提条件**: データ取得中
- **手順**: 
  1. 画面遷移やデータ更新を実行
- **期待結果**: 
  - ローディングインジケーターが表示される
- **優先度**: Medium

#### TC-1202: トースト通知の表示
- **前提条件**: 操作を実行
- **手順**: 
  1. 取引を登録
- **期待結果**: 
  - 成功/エラーメッセージがトーストで表示される
  - 自動的に消える
- **優先度**: Medium

#### TC-1203: モーダルの開閉
- **前提条件**: モーダルを開くボタンがある
- **手順**: 
  1. モーダルを開く
  2. 「キャンセル」または背景をクリック
- **期待結果**: 
  - モーダルが閉じる
  - フォームがリセットされる
- **優先度**: Medium

---

## テスト実行時の注意事項

1. **テストデータの準備**: 各テスト前に適切なテストデータを準備する
2. **テストの独立性**: 各テストは独立して実行できるようにする
3. **環境のクリーンアップ**: テスト後にデータベースをクリアする必要がある場合は実行する
4. **ブラウザの確認**: 主要ブラウザで動作確認する
5. **エラーログの確認**: コンソールにエラーが出ていないか確認する
