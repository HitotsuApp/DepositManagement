# 預り金管理Webアプリ - 実行計画

## 📊 現在の実装状況

### ✅ 完了している機能
- [x] D01: 法人ダッシュボード画面
- [x] F01: 施設詳細画面
- [x] U01: 利用者詳細画面（入金・出金・訂正入力）
- [x] P01: まとめて印刷画面（基本UI）
- [x] M01: マスタ管理画面（基本UI）
- [x] 残高計算ロジック（月次集計）
- [x] 初期データインポート機能
- [x] 共通コンポーネント（Sidebar, Card, DateSelector）
- [x] API実装（基本CRUD）

### ⚠️ 未実装・改善が必要な機能

#### 1. マスタ管理画面の機能実装
- [ ] 施設マスタ：追加フォーム・編集フォーム・無効化機能
- [ ] ユニットマスタ：追加フォーム・編集フォーム・無効化機能
- [ ] 利用者マスタ：追加フォーム・編集フォーム・無効化機能
- [ ] 施設名・ユニット名の表示改善（IDではなく名前を表示）

#### 2. 印刷機能の実装
- [ ] 印刷プレビューの実装（実際のデータ表示）
- [ ] PDF出力機能の実装
- [ ] 印刷用CSSスタイルの最適化
- [ ] 印刷単位ごとのデータ取得・表示

#### 3. UI/UXの改善
- [ ] ローディング状態の表示
- [ ] エラーメッセージの表示改善
- [ ] 成功メッセージの表示（トースト通知など）
- [ ] フォームバリデーションの強化
- [ ] レスポンシブデザインの最適化

#### 4. データ整合性の強化
- [ ] 利用者マスタの施設・ユニット選択UI改善
- [ ] 無効化時の確認ダイアログ
- [ ] 削除禁止の徹底（論理削除のみ）

#### 5. その他の改善
- [ ] エラーハンドリングの統一
- [ ] APIレスポンスの型定義
- [ ] テストデータの作成スクリプト

---

## 🎯 次の実行計画（優先順位順）

### Phase 1: マスタ管理機能の完全実装（最優先）

#### 1.1 施設マスタの追加・編集・無効化機能
**実装内容：**
- 追加フォームモーダル/インライン
- 編集フォーム（施設名、表示順の変更）
- 無効化機能（確認ダイアログ付き）
- API実装：`PUT /api/facilities/[id]`（編集）、`PATCH /api/facilities/[id]`（無効化）

**期待される成果：**
- 施設マスタの完全な管理が可能になる
- 施設の追加・編集・無効化がUIから実行できる

#### 1.2 ユニットマスタの追加・編集・無効化機能
**実装内容：**
- 追加フォーム（施設選択ドロップダウン含む）
- 編集フォーム（ユニット名、所属施設の変更）
- 無効化機能
- API実装：`PUT /api/units/[id]`、`PATCH /api/units/[id]`
- 施設名の表示改善（IDではなく名前）

**期待される成果：**
- ユニットマスタの完全な管理が可能になる
- 施設名が正しく表示される

#### 1.3 利用者マスタの追加・編集・無効化機能
**実装内容：**
- 追加フォーム（施設・ユニット選択、利用者名、開始日・終了日）
- 編集フォーム
- 無効化機能
- API実装：`PUT /api/residents/[id]`、`PATCH /api/residents/[id]`
- 施設名・ユニット名の表示改善

**期待される成果：**
- 利用者マスタの完全な管理が可能になる
- 施設・ユニット名が正しく表示される

**推定工数：** 2-3日

---

### Phase 2: 印刷機能の完全実装

#### 2.1 印刷プレビューの実装
**実装内容：**
- 印刷単位ごとのデータ取得API
- プレビュー画面の実装
- 印刷用レイアウトの作成
- 明細含む/含まないの切り替え

**期待される成果：**
- 印刷前に内容を確認できる
- 印刷単位ごとに適切なデータが表示される

#### 2.2 PDF出力機能の実装
**実装内容：**
- PDF生成ライブラリの導入（react-pdf または puppeteer）
- PDF生成APIの実装
- PDFダウンロード機能

**期待される成果：**
- PDF形式でデータを出力できる
- 印刷用に最適化されたPDFが生成される

**推定工数：** 2-3日

---

### Phase 3: UI/UXの改善

#### 3.1 ローディング・エラー・成功メッセージの実装
**実装内容：**
- ローディングスピナーの追加
- エラーメッセージの統一表示
- 成功メッセージの表示（トースト通知など）
- フォームバリデーションの強化

**期待される成果：**
- ユーザーが操作の結果を明確に把握できる
- エラー時の対応が分かりやすくなる

#### 3.2 レスポンシブデザインの最適化
**実装内容：**
- タブレット・スマートフォンでの表示最適化
- サイドバーの折りたたみ機能
- テーブルの横スクロール対応

**期待される成果：**
- 様々なデバイスで快適に利用できる

**推定工数：** 1-2日

---

### Phase 4: データ整合性・品質向上

#### 4.1 エラーハンドリングの統一
**実装内容：**
- APIエラーレスポンスの統一
- フロントエンドでのエラーハンドリング統一
- エラーログの記録

**期待される成果：**
- エラー処理が一貫性を持つ
- デバッグが容易になる

#### 4.2 型定義の強化
**実装内容：**
- APIレスポンスの型定義
- 共通型定義ファイルの作成
- TypeScriptのstrictモード対応

**期待される成果：**
- 型安全性の向上
- 開発効率の向上

**推定工数：** 1日

---

## 📝 実装時の注意事項

### データ整合性
- **削除は禁止**：すべて論理削除（`isActive = false`）のみ
- **編集・削除の履歴**：必要に応じて履歴テーブルの検討
- **外部キー制約**：施設・ユニット・利用者の関係性を維持

### UI/UX原則
- **追記のみ**：取引データは編集・削除不可
- **月次締め**：過去月は訂正入力のみ許可
- **シンプルな操作**：現場職員が迷わないUI

### パフォーマンス
- **残高計算**：毎回再計算するため、大量データ時のパフォーマンスに注意
- **ページネーション**：必要に応じて実装を検討

---

## 🚀 推奨実装順序

1. **Phase 1（マスタ管理機能）** ← 最優先
   - 現在ボタンだけあって機能していないため、ユーザビリティに直結

2. **Phase 3.1（ローディング・エラー表示）** ← 早期実装推奨
   - ユーザー体験の向上に直結
   - 実装が比較的簡単

3. **Phase 2（印刷機能）**
   - 業務上重要な機能だが、マスタ管理が優先

4. **Phase 3.2（レスポンシブ）**
   - タブレット利用を想定しているため重要度は高い

5. **Phase 4（品質向上）**
   - 長期的な保守性向上

---

## 📊 進捗管理

各Phase完了時に以下を確認：
- [ ] 機能が要件通りに動作するか
- [ ] エラーハンドリングが適切か
- [ ] UIが直感的か
- [ ] パフォーマンスに問題がないか

---

## 💡 追加検討事項（将来の拡張）

- 検索機能（利用者名、施設名での検索）
- エクスポート機能（CSV/Excel）
- バックアップ・復元機能
- 操作ログの記録
- 権限管理（将来的に必要になった場合）

